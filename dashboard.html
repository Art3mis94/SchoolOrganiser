<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Educator Hub - Dashboard</title>
<script src="https://cdn.tailwindcss.com"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

<style>
    body { font-family: 'Inter', sans-serif; background-color: #f3f4f6; }
    .nav-active { @apply bg-white text-indigo-700 shadow-inner; }
</style>
</head>
<body>

<!-- Navigation Bar -->
<nav class="bg-indigo-700 p-4 shadow-2xl">
    <div class="container max-w-4xl mx-auto flex flex-wrap justify-center gap-4">
        <a href="dashboard.html" class="px-4 py-2 nav-active font-semibold rounded-lg transition">Home ğŸ </a>
        <a href="curriculum_topics.html" class="px-4 py-2 text-white font-semibold rounded-lg hover:bg-indigo-600 transition">Topics ğŸ§ </a>
        <a href="notes.html" class="px-4 py-2 text-white font-semibold rounded-lg hover:bg-indigo-600 transition">Notes ğŸ“</a>
        <a href="todo.html" class="px-4 py-2 text-white font-semibold rounded-lg hover:bg-indigo-600 transition">To-Do List âœ…</a>
        <a href="resources.html" class="px-4 py-2 text-white font-semibold rounded-lg hover:bg-indigo-600 transition">Tools ğŸ› ï¸</a>
    </div>
</nav>

<!-- Dashboard Content -->
<div class="container max-w-4xl mx-auto p-8 bg-white rounded-3xl shadow-2xl mt-8 space-y-8">

    <h1 class="text-3xl font-bold text-center text-gray-800">Welcome to Your Dashboard ğŸ“</h1>

    <p id="userIdDisplay" class="text-center text-gray-500">Loading user...</p>

    <!-- Stats Section -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">

        <!-- Topics -->
        <div class="bg-indigo-600 text-white p-6 rounded-2xl shadow-xl flex flex-col items-center">
            <i class="fa-solid fa-brain text-4xl mb-3"></i>
            <h2 class="text-xl font-bold">Topics</h2>
            <p id="topicsCount" class="text-3xl font-bold mt-2">0</p>
        </div>

        <!-- Notes -->
        <div class="bg-orange-500 text-white p-6 rounded-2xl shadow-xl flex flex-col items-center">
            <i class="fa-solid fa-note-sticky text-4xl mb-3"></i>
            <h2 class="text-xl font-bold">Notes</h2>
            <p id="notesCount" class="text-3xl font-bold mt-2">0</p>
        </div>

        <!-- Pending Tasks -->
        <div class="bg-green-600 text-white p-6 rounded-2xl shadow-xl flex flex-col items-center">
            <i class="fa-solid fa-list-check text-4xl mb-3"></i>
            <h2 class="text-xl font-bold">Pending Tasks</h2>
            <p id="pendingTasksCount" class="text-3xl font-bold mt-2">0</p>
        </div>

    </div>

</div>

<!-- Firebase Logic -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
import { 
    getFirestore, 
    doc, 
    getDoc, 
    collection, 
    getDocs,
    onSnapshot 
} from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

// Firebase Config
const firebaseConfig = {
  apiKey: "AIzaSyChZSrBTGv0pjjSG-3XVOEI4eTXCQyk9cw",
  authDomain: "school-organiser-5f512.firebaseapp.com",
  projectId: "school-organiser-5f512",
  storageBucket: "school-organiser-5f512.appspot.com",
  messagingSenderId: "567803400438",
  appId: "1:567803400438:web:56ea2010e2d2a54fcc5cd7"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

// Elements
const userIdDisplay = document.getElementById("userIdDisplay");
const topicsCountEl = document.getElementById("topicsCount");
const notesCountEl = document.getElementById("notesCount");
const pendingTasksCountEl = document.getElementById("pendingTasksCount");

// Firestore paths
const USER_PATH = (uid) => ['artifacts', 'school-organiser-5f512', 'users', uid];

// Real-Time Dashboard Sync
onAuthStateChanged(auth, async (user) => {
    if (!user) {
        userIdDisplay.textContent = "Not signed in";
        return;
    }

    const uid = user.uid;
    userIdDisplay.textContent = `User ID: ${uid}`;

    // ---------------------------
    // â­ COUNT TOPICS
    // ---------------------------
    const topicsRef = collection(db, ...USER_PATH(uid), 'topics');
    onSnapshot(topicsRef, snap => {
        topicsCountEl.textContent = snap.size;
    });

    // ---------------------------
    // â­ COUNT NOTES
    // ---------------------------
    const notesRef = collection(db, ...USER_PATH(uid), 'daily_notes');
    onSnapshot(notesRef, snap => {
        notesCountEl.textContent = snap.size;
    });

    // ---------------------------
    // â­ COUNT PENDING TASKS  
    // (MATCHES todo.html EXACTLY)
    // ---------------------------
    const todoDocRef = doc(db, ...USER_PATH(uid), 'task_planner', 'todo_list');

    onSnapshot(todoDocRef, (docSnap) => {
        if (!docSnap.exists()) {
            pendingTasksCountEl.textContent = "0";
            return;
        }

        const data = docSnap.data();
        const tasks = data.tasks || [];

        const pending = tasks.filter(t => !t.completed).length;

        pendingTasksCountEl.textContent = pending;
    });

});
</script>

</body>
</html>