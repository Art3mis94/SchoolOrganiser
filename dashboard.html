<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Educator Hub - Dashboard</title>
<script src="https://cdn.tailwindcss.com"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
  body { font-family: 'Inter', sans-serif; background-color: #f3f4f6; }
  .card { @apply bg-white p-6 rounded-2xl shadow-lg cursor-pointer hover:shadow-2xl transition flex flex-col justify-between; }
  .card h2 { @apply text-3xl font-bold text-indigo-700; }
  .card p { @apply text-gray-600 font-semibold; }
  .card-details { @apply mt-2 text-gray-500 text-sm; }
</style>
</head>
<body>

<!-- Navbar -->
<nav class="bg-indigo-700 p-4 shadow-2xl">
  <div class="container max-w-5xl mx-auto flex flex-wrap justify-center gap-4">
      <a href="dashboard.html" class="px-4 py-2 bg-white text-indigo-700 font-bold rounded-lg shadow-inner">Home ğŸ </a>
      <a href="curriculum_topics.html" class="px-4 py-2 text-white font-semibold rounded-lg hover:bg-indigo-600 transition">Topics ğŸ§ </a>
      <a href="notes.html" class="px-4 py-2 text-white font-semibold rounded-lg hover:bg-indigo-600 transition">Notes ğŸ“</a>
      <a href="todo.html" class="px-4 py-2 text-white font-semibold rounded-lg hover:bg-indigo-600 transition">To-Do âœ…</a>
      <a href="resources.html" class="px-4 py-2 text-white font-semibold rounded-lg hover:bg-indigo-600 transition">Tools ğŸ› ï¸</a>
      <button id="logoutBtn" class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition">Sign Out</button>
  </div>
</nav>

<div class="container max-w-5xl mx-auto p-8 mt-8 space-y-8">

  <h1 class="text-4xl font-bold text-center text-gray-800 mb-8">Educator Hub Dashboard ğŸ‘©â€ğŸ«</h1>

  <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">

    <!-- Topics Card -->
    <div id="topicsCard" class="card" onclick="window.location.href='curriculum_topics.html'">
      <div class="flex items-center gap-3">
        <i class="fa-solid fa-brain text-indigo-500 text-4xl"></i>
        <div>
          <h2 id="topicsCount">0</h2>
          <p>Topics Covered</p>
        </div>
      </div>
      <p class="card-details" id="topicsPreview">Loading...</p>
    </div>

    <!-- Notes Card -->
    <div id="notesCard" class="card" onclick="window.location.href='notes.html'">
      <div class="flex items-center gap-3">
        <i class="fa-solid fa-sticky-note text-green-500 text-4xl"></i>
        <div>
          <h2 id="notesCount">0</h2>
          <p>Total Notes</p>
        </div>
      </div>
      <p class="card-details" id="notesPreview">Loading...</p>
    </div>

    <!-- Pending Tasks Card -->
    <div id="tasksCard" class="card" onclick="window.location.href='todo.html'">
      <div class="flex items-center gap-3">
        <i class="fa-solid fa-hourglass-start text-yellow-500 text-4xl"></i>
        <div>
          <h2 id="pendingTasks">0</h2>
          <p>Pending Tasks</p>
        </div>
      </div>
      <p class="card-details" id="tasksPreview">Loading...</p>
    </div>

  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
import { getFirestore, collection, query, onSnapshot, orderBy, where } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyChZSrBTGv0pjjSG-3XVOEI4eTXCQyk9cw",
  authDomain: "school-organiser-5f512.firebaseapp.com",
  projectId: "school-organiser-5f512",
  storageBucket: "school-organiser-5f512.appspot.com",
  messagingSenderId: "567803400438",
  appId: "1:567803400438:web:56ea2010e2d2a54fcc5cd7"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

const topicsCountEl = document.getElementById('topicsCount');
const topicsPreviewEl = document.getElementById('topicsPreview');
const notesCountEl = document.getElementById('notesCount');
const notesPreviewEl = document.getElementById('notesPreview');
const pendingTasksEl = document.getElementById('pendingTasks');
const tasksPreviewEl = document.getElementById('tasksPreview');
const logoutBtn = document.getElementById('logoutBtn');

onAuthStateChanged(auth, user => {
    if(!user) return window.location.href='index.html';
    const uid = user.uid;

    // Topics
    const topicsRef = collection(db, 'users', uid, 'topics');
    onSnapshot(topicsRef, snapshot => {
        topicsCountEl.textContent = snapshot.size;
        if(snapshot.empty) {
            topicsPreviewEl.textContent = "No topics yet.";
        } else {
            const topicNames = snapshot.docs.slice(0,3).map(doc => doc.data().name);
            topicsPreviewEl.textContent = `Latest: ${topicNames.join(", ")}${snapshot.size>3?'...':''}`;
        }
    });

    // Notes
    const notesRef = collection(db, 'users', uid, 'daily_notes');
    onSnapshot(notesRef, snapshot => {
        notesCountEl.textContent = snapshot.size;
        if(snapshot.empty) {
            notesPreviewEl.textContent = "No notes yet.";
        } else {
            const latestNote = snapshot.docs[snapshot.docs.length-1].data();
            notesPreviewEl.textContent = `Latest: ${latestNote.title || 'Untitled'}`;
        }
    });

    // Pending Tasks
    const tasksRef = collection(db, 'users', uid, 'tasks');
    const pendingQuery = query(tasksRef, where('completed', '==', false));
    onSnapshot(pendingQuery, snapshot => {
        pendingTasksEl.textContent = snapshot.size;
        if(snapshot.empty) {
            tasksPreviewEl.textContent = "All caught up!";
        } else {
            const latestTask = snapshot.docs[snapshot.docs.length-1].data();
            tasksPreviewEl.textContent = `Next: ${latestTask.text || 'Task'}`;
        }
    });
});

logoutBtn.onclick = async () => {
    await signOut(auth);
    window.location.href='index.html';
};
</script>

</body>
</html>