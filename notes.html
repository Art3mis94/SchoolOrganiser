<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Educator Hub - Notes</title>
<script src="https://cdn.tailwindcss.com"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
  .nav-active { @apply bg-white text-indigo-700 shadow-inner; }
  body { font-family: 'Inter', sans-serif; }
</style>
</head>
<body class="bg-gray-100 min-h-screen">

<!-- Navbar -->
<nav class="bg-indigo-700 p-4 shadow-2xl">
  <div class="container max-w-4xl mx-auto flex flex-wrap justify-center gap-4">
    <a href="dashboard.html" class="px-4 py-2 text-white font-semibold rounded-lg hover:bg-indigo-600 transition">Home ğŸ </a>
    <a href="curriculum_topics.html" class="px-4 py-2 text-white font-semibold rounded-lg hover:bg-indigo-600 transition">Topics ğŸ§ </a>
    <a href="notes.html" class="px-4 py-2 bg-white text-indigo-700 font-bold rounded-lg shadow-inner transition">Notes ğŸ“</a>
    <a href="todo.html" class="px-4 py-2 text-white font-semibold rounded-lg hover:bg-indigo-600 transition">To-Do âœ…</a>
    <a href="resources.html" class="px-4 py-2 text-white font-semibold rounded-lg hover:bg-indigo-600 transition">Tools ğŸ› ï¸</a>
  </div>
</nav>

<div class="container max-w-4xl mx-auto p-8 bg-white rounded-3xl shadow-2xl mt-8 space-y-6">
  <div class="flex justify-between items-center mb-4">
    <h1 class="text-3xl font-bold text-indigo-700">Teaching Notes</h1>
    <button id="newNoteBtn" class="bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 transition">
      <i class="fa-solid fa-plus mr-1"></i> New Note
    </button>
  </div>

  <div id="notesContainer" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"></div>
</div>

<!-- Note Modal -->
<div id="noteModal" class="fixed inset-0 bg-gray-600 bg-opacity-75 flex items-center justify-center z-50 hidden">
  <div class="bg-white rounded-xl shadow-2xl w-full max-w-md p-6">
    <div class="flex justify-between items-center pb-3 border-b">
      <h3 class="text-2xl font-bold text-indigo-700">Add/Edit Note</h3>
      <button id="closeNoteModal" class="text-gray-400 hover:text-gray-600 text-xl">
        <i class="fa-solid fa-xmark"></i>
      </button>
    </div>
    <form id="noteForm" class="space-y-4">
      <input type="text" id="noteTitle" placeholder="Title" class="w-full p-2 border rounded-md" required>
      <textarea id="noteContent" rows="5" placeholder="Type your note here..." class="w-full p-2 border rounded-md"></textarea>
      <button type="submit" class="w-full py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition">Save Note</button>
    </form>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { 
  getAuth, 
  onAuthStateChanged, 
  signOut 
} from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
import { 
  getFirestore,
  collection, 
  addDoc, 
  updateDoc, 
  deleteDoc, 
  doc, 
  onSnapshot, 
  query, 
  orderBy, 
  serverTimestamp
} from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

// Firebase Config
const firebaseConfig = {
  apiKey: "AIzaSyChZSrBTGv0pjjSG-3XVOEI4eTXCQyk9cw",
  authDomain: "school-organiser-5f512.firebaseapp.com",
  projectId: "school-organiser-5f512",
  storageBucket: "school-organiser-5f512.appspot.com",
  messagingSenderId: "567803400438",
  appId: "1:567803400438:web:56ea2010e2d2a54fcc5cd7"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

// UI Elements
const newNoteBtn = document.getElementById("newNoteBtn");
const noteModal = document.getElementById("noteModal");
const closeNoteModal = document.getElementById("closeNoteModal");
const noteForm = document.getElementById("noteForm");
const noteTitle = document.getElementById("noteTitle");
const noteContent = document.getElementById("noteContent");
const notesContainer = document.getElementById("notesContainer");

let currentUser = null;
let editingNoteId = null;

// Auth Guard
onAuthStateChanged(auth, (user) => {
  if (!user) {
    window.location.href = "index.html";
  } else {
    currentUser = user;
    loadNotes();
  }
});

// Notes Collection Reference
const notesRef = () => collection(db, "users", currentUser.uid, "notes");

// Load Notes
function loadNotes() {
  const q = query(notesRef(), orderBy("createdAt", "desc"));
  onSnapshot(q, snapshot => {
    notesContainer.innerHTML = "";
    snapshot.forEach(docSnap => {
      const note = { id: docSnap.id, ...docSnap.data() };
      const card = document.createElement("div");
      card.className = "bg-white p-4 rounded-xl shadow hover:shadow-lg transition flex flex-col justify-between";
      card.innerHTML = `
        <div>
          <h3 class="font-bold text-indigo-700 text-lg mb-1">${note.title}</h3>
          <p class="text-gray-700 text-sm mb-2">${note.content || ""}</p>
        </div>
        <div class="flex justify-end gap-2">
          <button class="editNoteBtn text-blue-600"><i class="fa-solid fa-pen"></i></button>
          <button class="deleteNoteBtn text-red-600"><i class="fa-solid fa-trash"></i></button>
        </div>
      `;
      notesContainer.appendChild(card);

      card.querySelector(".editNoteBtn").onclick = () => {
        editingNoteId = note.id;
        noteTitle.value = note.title;
        noteContent.value = note.content || "";
        noteModal.classList.remove("hidden");
      };

      card.querySelector(".deleteNoteBtn").onclick = async () => {
        if (confirm("Delete this note?")) {
          await deleteDoc(doc(notesRef(), note.id));
        }
      };
    });
  });
}

// Modal Open/Close
newNoteBtn.onclick = () => {
  editingNoteId = null;
  noteForm.reset();
  noteModal.classList.remove("hidden");
};
closeNoteModal.onclick = () => noteModal.classList.add("hidden");

// Save Note
noteForm.onsubmit = async (e) => {
  e.preventDefault();
  const data = {
    title: noteTitle.value,
    content: noteContent.value,
    createdAt: serverTimestamp()
  };
  if (editingNoteId) {
    await updateDoc(doc(notesRef(), editingNoteId), data);
  } else {
    await addDoc(notesRef(), data);
  }
  noteForm.reset();
  noteModal.classList.add("hidden");
};
</script>
</body>
</html>