<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tools - Educator Hub</title>
<script src="https://cdn.tailwindcss.com"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
<style>
.drag-zone {
    border: 2px dashed #9ca3af;
    text-align: center;
    padding: 20px;
    border-radius: 8px;
    cursor: pointer;
}
.drag-over { border-color: #4f46e5; background-color: #eef2ff; }
.task-item { @apply flex justify-between items-center p-4 bg-white border rounded-lg shadow-sm; }
.completed-task { @apply bg-green-50 border-green-200 line-through text-gray-500; }
</style>
</head>
<body class="bg-gray-100">

<div class="container max-w-4xl mx-auto p-8 bg-white rounded-3xl shadow-2xl mt-8 space-y-6">

<h1 class="text-3xl font-bold text-center text-gray-800">Tools - Lesson Resources</h1>

<!-- Lesson Resource Import -->
<form id="lessonResourceImportForm" class="space-y-4">
    <select id="importTopicSelect" required class="w-full p-3 border rounded-lg bg-white">
        <option value="">-- Select Topic --</option>
    </select>

    <select id="importLessonSelect" required class="w-full p-3 border rounded-lg bg-white" disabled>
        <option value="">-- Select Lesson --</option>
    </select>

    <textarea id="importResourcesText" placeholder="Paste link(s) one per line" class="w-full p-3 border rounded-lg"></textarea>

    <div id="fileLessonDropZone" class="drag-zone">
        <p><i class="fa-solid fa-file-circle-plus mr-2"></i> Drag & Drop a file here</p>
        <input type="file" id="lessonFile" class="hidden">
    </div>

    <button type="submit" class="w-full p-3 bg-green-600 text-white rounded-lg"><i class="fa-solid fa-cloud-arrow-up mr-2"></i>Add Resource</button>
</form>

<div id="lessonAttachmentsList" class="space-y-4 mt-6"></div>

</div>

<script type="module">
let curriculumLessons = {}; // Shared in-memory
let curriculumTopics = [];
let currentUser = { uid: 'dummy-user' }; // Simulated auth

const importTopicSelect = document.getElementById('importTopicSelect');
const importLessonSelect = document.getElementById('importLessonSelect');
const lessonAttachmentsList = document.getElementById('lessonAttachmentsList');
const lessonFileInput = document.getElementById('lessonFile');
const fileDropZone = document.getElementById('fileLessonDropZone');

// Simulate fetching topics & lessons
function loadCurriculumData() {
    curriculumTopics = [
        {id:'topic1', name:'Math'},
        {id:'topic2', name:'Science'}
    ];

    curriculumTopics.forEach(t => {
        curriculumLessons[t.id] = [
            {id:'lesson1', title:'Lesson 1', links:[], files:[]},
            {id:'lesson2', title:'Lesson 2', links:[], files:[]}
        ];
        const opt = document.createElement('option');
        opt.value = t.id; opt.textContent = t.name;
        importTopicSelect.appendChild(opt);
    });
}
loadCurriculumData();

importTopicSelect.onchange = () => {
    const topicId = importTopicSelect.value;
    importLessonSelect.innerHTML = '<option value="">-- Select Lesson --</option>';
    importLessonSelect.disabled = !topicId;

    if (topicId) {
        curriculumLessons[topicId].forEach(lesson => {
            const opt = document.createElement('option');
            opt.value = lesson.id; opt.textContent = lesson.title;
            importLessonSelect.appendChild(opt);
        });
    }
};

function renderAllLessonAttachments() {
    lessonAttachmentsList.innerHTML = '';
    const topicId = importTopicSelect.value;
    const lessonId = importLessonSelect.value;
    if (!topicId || !lessonId) return;
    const lesson = curriculumLessons[topicId].find(l => l.id === lessonId);

    lesson.links.forEach(link => {
        const div = document.createElement('div');
        div.className = 'task-item';
        div.innerHTML = `<i class="fa-solid fa-link text-blue-600 mr-2"></i>
        <a href="${link}" target="_blank">${link}</a>`;
        lessonAttachmentsList.appendChild(div);
    });

    lesson.files.forEach(file => {
        const div = document.createElement('div');
        div.className = 'task-item';
        div.innerHTML = `<i class="fa-solid fa-file-upload text-purple-600 mr-2"></i>
        <a href="${file.url}" target="_blank">${file.name}</a>`;
        lessonAttachmentsList.appendChild(div);
    });
}

// Drag & Drop
fileDropZone.addEventListener('dragover', e => { e.preventDefault(); fileDropZone.classList.add('drag-over'); });
fileDropZone.addEventListener('dragleave', e => fileDropZone.classList.remove('drag-over'));
fileDropZone.addEventListener('drop', e => {
    e.preventDefault(); fileDropZone.classList.remove('drag-over');
    lessonFileInput.files = e.dataTransfer.files;
    fileDropZone.querySelector('p').textContent = `File selected: ${lessonFileInput.files[0].name}`;
});
fileDropZone.onclick = () => lessonFileInput.click();
lessonFileInput.onchange = () => {
    fileDropZone.querySelector('p').textContent = `File selected: ${lessonFileInput.files[0].name}`;
};

// Form Submit
document.getElementById('lessonResourceImportForm').onsubmit = e => {
    e.preventDefault();
    const topicId = importTopicSelect.value;
    const lessonId = importLessonSelect.value;
    if (!topicId || !lessonId) return alert('Select Topic & Lesson');

    const lesson = curriculumLessons[topicId].find(l => l.id === lessonId);

    // Add links
    const text = document.getElementById('importResourcesText').value.trim();
    if (text) {
        const lines = text.split('\n').filter(l=>l.trim()!=='');
        lesson.links.push(...lines);
    }

    // Add file (in-memory)
    if (lessonFileInput.files[0]) {
        lesson.files.push({
            name: lessonFileInput.files[0].name,
            url: URL.createObjectURL(lessonFileInput.files[0])
        });
        lessonFileInput.value = '';
        fileDropZone.querySelector('p').innerHTML = `<i class="fa-solid fa-file-circle-plus mr-2"></i> Drag & Drop a file here`;
    }

    document.getElementById('importResourcesText').value = '';
    renderAllLessonAttachments();
    alert('Resource added!');
};
</script>
</body>
</html>