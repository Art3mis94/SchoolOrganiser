<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Educator Hub - To-Do List</title>
<script src="https://cdn.tailwindcss.com"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
<style>
    body { font-family: 'Inter', sans-serif; background-color: #f3f4f6; }
    .nav-active { @apply bg-white text-indigo-700 shadow-inner; }
    .task-item { @apply flex justify-between items-center p-4 bg-white border border-gray-200 rounded-lg shadow-sm hover:shadow-md transition; }
    .completed-task { @apply bg-green-50 border-green-200 line-through text-gray-500; }
    button { @apply transition duration-200; }
</style>
</head>
<body>

<!-- Navbar -->
<nav class="bg-indigo-700 p-4 shadow-2xl">
    <div class="container max-w-4xl mx-auto flex flex-wrap justify-center gap-4">
        <a href="dashboard.html" class="px-4 py-2 text-white font-semibold rounded-lg hover:bg-indigo-600 transition">Home ğŸ </a>
        <a href="curriculum_topics.html" class="px-4 py-2 text-white font-semibold rounded-lg hover:bg-indigo-600 transition">Topics ğŸ§ </a>
        <a href="notes.html" class="px-4 py-2 text-white font-semibold rounded-lg hover:bg-indigo-600 transition">Notes ğŸ“</a>
        <a href="todo.html" class="px-4 py-2 nav-active font-bold rounded-lg transition">To-Do List âœ…</a>
        <a href="resources.html" class="px-4 py-2 text-white font-semibold rounded-lg hover:bg-indigo-600 transition">Tools ğŸ› ï¸</a>
    </div>
</nav>

<!-- Page Content -->
<div class="container max-w-4xl mx-auto p-8 bg-white rounded-3xl shadow-2xl mt-8 space-y-6">
    <h1 class="text-3xl font-bold text-center text-gray-800">Daily To-Do List âœ…</h1>
    <p id="userIdDisplay" class="text-center text-gray-500 mb-4">User ID: Loading...</p>

    <!-- Add Task Form -->
    <form id="addTaskForm" class="flex gap-2 mb-6">
        <input type="text" id="taskInput" placeholder="Enter new task..." class="flex-1 p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500" required>
        <button type="submit" class="p-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition">
            <i class="fa-solid fa-plus"></i> Add
        </button>
    </form>

    <!-- Task Lists -->
    <div>
        <h2 class="text-2xl font-bold text-gray-700 mb-2 flex items-center gap-2"><i class="fa-solid fa-hourglass-start"></i> Pending Tasks</h2>
        <div id="pendingTasksList" class="space-y-3">
            <p class="text-gray-500 italic text-center">No pending tasks.</p>
        </div>
    </div>

    <div class="mt-6">
        <h2 class="text-2xl font-bold text-gray-700 mb-2 flex items-center gap-2"><i class="fa-solid fa-check-double"></i> Completed Tasks</h2>
        <div id="completedTasksList" class="space-y-3">
            <p class="text-gray-500 italic text-center">No completed tasks yet.</p>
        </div>
    </div>
</div>

<!-- Firebase Logic -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
import { getFirestore, doc, setDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

// --- Firebase Config ---
const firebaseConfig = {
  apiKey: "AIzaSyChZSrBTGv0pjjSG-3XVOEI4eTXCQyk9cw",
  authDomain: "school-organiser-5f512.firebaseapp.com",
  projectId: "school-organiser-5f512",
  storageBucket: "school-organiser-5f512.appspot.com",
  messagingSenderId: "567803400438",
  appId: "1:567803400438:web:56ea2010e2d2a54fcc5cd7"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

let userId = null;
let tasks = [];

const userIdDisplay = document.getElementById('userIdDisplay');
const addTaskForm = document.getElementById('addTaskForm');
const taskInput = document.getElementById('taskInput');
const pendingTasksList = document.getElementById('pendingTasksList');
const completedTasksList = document.getElementById('completedTasksList');

const TODO_DOC_REF = (uid) => doc(db, 'artifacts', 'school-organiser-5f512', 'users', uid, 'task_planner', 'todo_list');

// Render tasks
function renderTasks() {
    pendingTasksList.innerHTML = '';
    completedTasksList.innerHTML = '';

    const pending = tasks.filter(t => !t.completed).sort((a,b) => new Date(a.timestamp)-new Date(b.timestamp));
    const completed = tasks.filter(t => t.completed).sort((a,b) => new Date(b.timestamp)-new Date(a.timestamp));

    if(pending.length === 0) pendingTasksList.innerHTML = '<p class="text-gray-500 italic text-center">No pending tasks.</p>';
    else pending.forEach(task => pendingTasksList.appendChild(createTaskElement(task)));

    if(completed.length === 0) completedTasksList.innerHTML = '<p class="text-gray-500 italic text-center">No completed tasks yet.</p>';
    else completed.forEach(task => completedTasksList.appendChild(createTaskElement(task)));
}

// Create task DOM element
function createTaskElement(task) {
    const div = document.createElement('div');
    div.className = `task-item ${task.completed?'completed-task':''}`;
    div.innerHTML = `
        <div class="flex items-center gap-3 flex-1 min-w-0">
            <button onclick="toggleTaskCompletion('${task.id}')" class="text-xl">
                <i class="${task.completed?'fa-solid fa-check-square text-green-500':'fa-regular fa-square text-gray-400 hover:text-indigo-500'}"></i>
            </button>
            <span class="truncate ${task.completed?'line-through text-gray-500':'font-medium'}">${task.text}</span>
        </div>
        <button onclick="deleteTask('${task.id}')" class="text-red-400 hover:text-red-600"><i class="fa-solid fa-trash-can"></i></button>
    `;
    return div;
}

// Toggle completion
window.toggleTaskCompletion = async (taskId) => {
    const task = tasks.find(t=>t.id===taskId);
    if(task){ task.completed=!task.completed; await saveTasks(); }
};

// Delete task
window.deleteTask = async (taskId) => {
    if(!confirm('Delete this task?')) return;
    tasks = tasks.filter(t=>t.id!==taskId);
    await saveTasks();
};

// Save tasks to Firestore
async function saveTasks() {
    if(!userId) return;
    await setDoc(TODO_DOC_REF(userId), {tasks});
}

// Add new task
addTaskForm.addEventListener('submit', async (e)=>{
    e.preventDefault();
    const text = taskInput.value.trim();
    if(!text) return;
    const newTask = {id: Date.now().toString(), text, completed:false, timestamp:new Date().toISOString()};
    tasks.push(newTask);
    await saveTasks();
    taskInput.value='';
    renderTasks();
});

// Listen to auth state and Firestore
onAuthStateChanged(auth, user => {
    if(user){
        userId=user.uid;
        userIdDisplay.textContent=`User ID: ${userId}`;
        onSnapshot(TODO_DOC_REF(userId), docSnap=>{
            if(docSnap.exists()) tasks=docSnap.data().tasks||[];
            else tasks=[];
            renderTasks();
        });
    } else {
        userIdDisplay.textContent='User not authenticated';
    }
});
</script>

</body>
</html>